pipeline {
    agent any
options {
    buildDiscarder(logRotator(numToKeepStr: '30', artifactNumToKeepStr: '30'))
  }



        environment {
		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
	}

 environment {
        Username = 'devopseasylearning2021'
        

    }

    stages {



        stage('build images') {
            steps {
               sh '''
               docker build -t kelly:001 .
               '''
            }
        }


        stage('Tag image') {
            steps {
                sh '''
               docker tag kelly:001 devopseasylearning2021/kelly:001
               '''
            }
        }





    stage('Login') {

			steps {
				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
			}
		}




        stage('docker push') {
            steps {
                sh '''
               docker push devopseasylearning2021/kelly:001
               '''
            }
        }





    }




}
