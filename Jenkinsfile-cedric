pipeline {
    agent any

   environment {
		DOCKERHUB_CREDENTIALS=credentials('dockerhub')
	}

   options { buildDiscarder(logRotator(artifactDaysToKeepStr: '',
     artifactNumToKeepStr: '', daysToKeepStr: '3', numToKeepStr: '5'))
      disableConcurrentBuilds() }


    stages {

        stage('build images') {
            steps {
                sh '''
                docker build -t cedric:001 .
                '''
            }
        }

    
        stage('tag images') {
            steps {
                sh '''
                docker tag cedric:001 devopseasylearning2021/cedric_0314:001
                '''
            }
        }


        stage('Login') {

			steps {
				sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
			}
		}





        stage('docker push') {
            steps {
                sh '''
                docker push devopseasylearning2021/cedric_0314:001
                '''
            }
        }



        
    }
}
